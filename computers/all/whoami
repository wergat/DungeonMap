os.loadAPI(":dungeon/dcore/apis/dcore")
local tArgs = {...}
local init = false
if(tArgs[1])then init = true end
if(dcore)then dcore.runFileInAllMods("whoami")end
local x,y,z = commands.getBlockPosition()
local block = commands.getBlockInfo(x,y-1,z)
print("No special block data found in mods, looking for native versions")

-- Check for mobile computer
if(pocket)then
	-- Execute mobile scripts
end




-- Main Computer
if(block.name == "minecraft:quartz_block")then
	print("Identified as Dev Computer")
	if(init)then
		print("Updating")
		sleep(1)
		local update = shell.run("dungeon/computers/all/update","https://api.github.com/repos/wergat/DungeonMap/contents/")
		if(not update)then printError("Update File not found!") end
		sleep(1)
		local open = fs.open(":startup","w")
		open.write("shell.run(\"dungeon/computers/all/whoami\")")
		open.close()
		sleep(1)
		os.reboot()
	else
		print("Running main function")
		shell.run("dungeon/computers/dev/main")
	end
end

-- Settings monitor
if(block.name == "minecraft:wool")then
	shell.run("dungeon/computers/all/update","https://api.github.com/repos/wergat/DungeonMap/contents/dcore/","https://api.github.com/repos/wergat/DungeonMap/contents/computers/option","https://api.github.com/repos/wergat/DungeonMap/contents/computers/all","https://api.github.com/repos/wergat/DungeonMap/contents/mods/")
	if(init)then
		sleep(1)
		os.reboot()
	end
	local side = nil
	for k,v in pairs(peripheral.getNames()) do
		if(peripheral.getType(v))then
			side = v
		end
	end
	if(side)then
		shell.run("monitor "..side.." dungeon/computers/option/main")
	end
end

-- cmd_salve
if(block.name == "minecraft:iron_block")then
	local update = shell.run("dungeon/computers/all/update","https://api.github.com/repos/wergat/DungeonMap/contents/dcore/apis/github","https://api.github.com/repos/wergat/DungeonMap/contents/computers/all","https://api.github.com/repos/wergat/DungeonMap/contents/computers/cmd_slave","https://api.github.com/repos/wergat/DungeonMap/contents/dcore/apis/dcore")
	if(not update)then print("Update File not found!") end
	shell.run("dungeon/computers/cmd_slave/main")
end
